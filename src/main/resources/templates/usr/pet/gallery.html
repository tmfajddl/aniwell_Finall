<!DOCTYPE html>
<html lang="ko">

<head>
	<link rel="stylesheet" th:href="@{/resource/css/common.css}">
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" th:href="@{/resource/css/global.css}">
	<title>ê°ì • ê²°ê³¼ ê°¤ëŸ¬ë¦¬</title>
	<style>
		h2 {
			text-align: center;
			color: #444;
			padding: 30px;
		}

		.tabs {
			text-align: center;
			margin-bottom: 20px;
		}

		.tabs button {
			padding: 10px 20px;
			margin: 6px;
			border: none;
			background-color: #ffe28a;
			border-radius: 30px;
			font-size: 14px;
			font-weight: bold;
			cursor: pointer;
			transition: background-color 0.3s;
			box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.1);
		}

		.tabs button.active {
			background-color: #ffcd29;
			color: white;
		}

		.gallery-section {
			display: none;
			overflow: hidden;
			position: relative;
			flex-grow: 1;
		}

		.gallery-section.active {
			display: block;
		}

		.gallery-track {
			gap: 20px;
			transition: transform 0.2s linear;
			will-change: transform;
		}

		.label {
			display: block;
			font-size: 14px;
			color: #777;
		}

		/* ====== ëŒ€ìë³´ ë ˆì´ì•„ì›ƒ ê³µí†µ ë³€ìˆ˜ ====== */
		:root {
			--row-gap: 28px;
			/* í–‰ ê°„ê²© */
			--overlap-x: -22px;
			/* ì¹´ë“œ ê°€ë¡œ ê²¹ì¹¨(ìŒìˆ˜=ë” ê²¹ì¹¨) */
			--lift: -6px;
			/* ì¼ë¶€ ì¹´ë“œ ì‚´ì§ ë“¤ë¦¼ */
			--radius: 18px;
			/* â† ì›í•˜ëŠ” í”½ì…€ ì¦ê°€ëŸ‰ */
			--grow-px: 10px;
		}

		/* ì„¹ì…˜ ì•ˆìª½ ë³´ë“œ(ì„¸ë¡œ ìŠ¤í¬ë¡¤) */
		.gallery-board {
			display: flex;
			flex-direction: column;
			gap: var(--row-gap);
			padding: 35px 8px;
		}

		/* í•œ í–‰ */
		.row {
			display: flex;
			align-items: flex-end;
			gap: 18px;
			justify-content: flex-start;
			position: relative;
		}

		/* 2ë²ˆì§¸ ì´í›„ ì¹´ë“œë“¤ì€ ì‚´ì§ ê²¹ì¹˜ê¸° */
		.row .card+.card {
			margin-left: var(--overlap-x);
		}

		.card {
			margin: 0 8px;
			position: relative;
			width: clamp(180px, 23vw, 240px);
			aspect-ratio: 4/5;
			--radius: 18px;
			/* í˜¹ì‹œ ì—†ìœ¼ë©´ ê¸°ë³¸ ë°˜ê²½ ì •ì˜ */
			border-radius: var(--radius);
			background: #fff;
			box-shadow: 0 8px 24px rgba(0, 0, 0, .10);
			overflow: hidden;

			transform-origin: 50% 85%;
			transform: translateZ(0) scale(1);
			/* ê¸°ë³¸ í¬ê¸° */
			transition: transform .18s ease, box-shadow .18s ease, z-index .18s ease;
		}

		.card:hover {
			/* JSê°€ --hover-scaleì„ ê³„ì‚°í•´ì¤Œ */
			transform: translateZ(0) scale(var(--hover-scale, 1));
			box-shadow: 0 12px 32px rgba(0, 0, 0, .16);
			z-index: 2;
		}

		.card img {
			width: 100%;
			height: 75%;
			object-fit: cover;
			display: block;
			border-radius: 12px;
			margin-bottom: 0;
			/* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ë¬´ë ¥í™” */
		}

		.card strong {
			display: block;
			text-align: center;
			margin-top: 8px;
		}

		.card .label {
			display: block;
			font-size: 14px;
			color: #777;
			text-align: center;
		}

		.card::before {
			content: "";
			position: absolute;
			inset: 0;
			border-radius: inherit;
			background: radial-gradient(transparent 60%, rgba(0, 0, 0, .04));
			pointer-events: none;
		}

		/* Row A íŒ¨í„´: [-4, 1, -2, 3] */
		.row-a .card:nth-child(1) {
			--rot: -4deg;
			transform: rotate(var(--rot));
			z-index: 4;
		}

		.row-a .card:nth-child(2) {
			--rot: 1deg;
			transform: translateY(var(--lift)) rotate(var(--rot));
			z-index: 3;
		}

		.row-a .card:nth-child(3) {
			--rot: -2deg;
			transform: rotate(var(--rot));
			z-index: 2;
		}

		.row-a .card:nth-child(4) {
			--rot: 3deg;
			transform: translateY(var(--lift)) rotate(var(--rot));
			z-index: 1;
		}

		/* Row B íŒ¨í„´: [2, -3, 1, -1] */
		.row-b .card:nth-child(1) {
			--rot: 2deg;
			transform: translateY(var(--lift)) rotate(var(--rot));
			z-index: 1;
		}

		.row-b .card:nth-child(2) {
			--rot: -3deg;
			transform: rotate(var(--rot));
			z-index: 2;
		}

		.row-b .card:nth-child(3) {
			--rot: 1deg;
			transform: translateY(var(--lift)) rotate(var(--rot));
			z-index: 3;
		}

		.row-b .card:nth-child(4) {
			--rot: -1deg;
			transform: rotate(var(--rot));
			z-index: 4;
		}

		/* ë°˜ì‘í˜•(ì„ íƒ) */
		@media (max-width:1024px) {
			.card {
				width: clamp(160px, 30vw, 220px);
			}

			:root {
				--overlap-x: -16px;
			}
		}

		@media (max-width:640px) {
			.card {
				width: clamp(150px, 44vw, 200px);
			}

			:root {
				--overlap-x: -12px;
			}
		}

		/* === â–¼ í–‰ ì¥ì‹ ê³µí†µ ë³€ìˆ˜/ê¸°ë³¸ê°’ (gallery.htmlì— ì¶”ê°€) === */
		.gallery-board {
			--deco-color: #A8C7AF;
			/* ì¥ì‹ ìƒ‰ìƒ (currentColor) */
			--deco-size: 80px;
			/* ì¥ì‹ ê¸°ë³¸ í¬ê¸° */
		}

		/* ê³µí†µ: ë§ˆìŠ¤í¬ ì¥ì‹ì„ ìœ„í•œ ë² ì´ìŠ¤ (::before/::afterì— ì ìš©) */
		.row,
		.card {
			position: relative;
		}

		/* ===== 1í–‰(=row-a): ì™¼ìª½ ìƒë‹¨ 'í´ë¦½' ì¥ì‹ - ì²« ë²ˆì§¸ ì¹´ë“œì— ë¶€ì°© ===== */
		.row-a::before {
			z-index: 10;
			content: "";
			position: absolute;
			top: -10px;
			left: -10px;
			width: var(--deco-size);
			height: var(--deco-size);
			color: var(--deco-color);
			background-color: currentColor;
			filter: drop-shadow(0 1px 3px rgba(0, 0, 0, .25));
			transform: rotate(-12deg);
			/* Safari & í‘œì¤€ ë§ˆìŠ¤í¬ */
			-webkit-mask: url("data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 91 91' fill='currentColor'%3E%3Cpath d='M88.3,34.924c-1.304-1.305-3.419-1.305-4.724,0L40.378,78.117c-3.561,3.561-8.238,5.568-13.175,5.652c-4.922,0.104-9.454-1.732-12.843-5.121c-7.027-7.027-6.789-18.701,0.529-26.02c0.01-0.01,0.016-0.021,0.026-0.032l41.019-41.016c4.5-4.492,11.817-4.49,16.319,0.009c4.503,4.504,4.503,11.832,0,16.336c-0.005,0.005-0.008,0.011-0.013,0.016L30.501,69.68c-0.002,0.002-0.002,0.003-0.004,0.005c-1.873,1.865-4.92,1.864-6.789-0.005c-0.908-0.906-1.41-2.113-1.41-3.396c0-1.281,0.498-2.482,1.4-3.388c0.005-0.004,0.01-0.007,0.014-0.011l37.43-37.438c1.304-1.305,1.304-3.418-0.001-4.723s-3.419-1.305-4.724,0l-37.41,37.418c-0.007,0.007-0.016,0.011-0.021,0.018c-2.172,2.168-3.367,5.055-3.367,8.123s1.195,5.951,3.369,8.125c2.238,2.234,5.179,3.352,8.118,3.352c2.94-0.002,5.881-1.117,8.118-3.354c0.005-0.005,0.008-0.011,0.014-0.016l41.736-41.735c0.001-0.002,0.003-0.003,0.005-0.005c0.003-0.003,0.006-0.007,0.009-0.01l0.711-0.711c0.182-0.181,0.331-0.38,0.462-0.588c5.896-7.155,5.505-17.787-1.183-24.477c-6.69-6.686-17.318-7.074-24.469-1.181c-0.208,0.131-0.407,0.281-0.588,0.462L10.163,47.904c-0.01,0.009-0.015,0.02-0.023,0.029C0.243,57.859,0.017,73.748,9.638,83.371c4.578,4.578,10.683,7.084,17.235,7.084c0.148,0,0.297-0.004,0.445-0.006c6.677-0.113,12.993-2.816,17.784-7.609c0.004-0.003,0.006-0.008,0.009-0.011L88.3,39.646C89.604,38.344,89.604,36.229,88.3,34.924z'/%3E%3C/svg%3E") no-repeat center / contain;
			mask: url("data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 91 91' fill='currentColor'%3E%3Cpath d='M88.3,34.924c-1.304-1.305-3.419-1.305-4.724,0L40.378,78.117c-3.561,3.561-8.238,5.568-13.175,5.652c-4.922,0.104-9.454-1.732-12.843-5.121c-7.027-7.027-6.789-18.701,0.529-26.02c0.01-0.01,0.016-0.021,0.026-0.032l41.019-41.016c4.5-4.492,11.817-4.49,16.319,0.009c4.503,4.504,4.503,11.832,0,16.336c-0.005,0.005-0.008,0.011-0.013,0.016L30.501,69.68c-0.002,0.002-0.002,0.003-0.004,0.005c-1.873,1.865-4.92,1.864-6.789-0.005c-0.908-0.906-1.41-2.113-1.41-3.396c0-1.281,0.498-2.482,1.4-3.388c0.005-0.004,0.01-0.007,0.014-0.011l37.43-37.438c1.304-1.305,1.304-3.418-0.001-4.723s-3.419-1.305-4.724,0l-37.41,37.418c-0.007,0.007-0.016,0.011-0.021,0.018c-2.172,2.168-3.367,5.055-3.367,8.123s1.195,5.951,3.369,8.125c2.238,2.234,5.179,3.352,8.118,3.352c2.94-0.002,5.881-1.117,8.118-3.354c0.005-0.005,0.008-0.011,0.014-0.016l41.736-41.735c0.001-0.002,0.003-0.003,0.005-0.005c0.003-0.003,0.006-0.007,0.009-0.01l0.711-0.711c0.182-0.181,0.331-0.38,0.462-0.588c5.896-7.155,5.505-17.787-1.183-24.477c-6.69-6.686-17.318-7.074-24.469-1.181c-0.208,0.131-0.407,0.281-0.588,0.462L10.163,47.904c-0.01,0.009-0.015,0.02-0.023,0.029C0.243,57.859,0.017,73.748,9.638,83.371c4.578,4.578,10.683,7.084,17.235,7.084c0.148,0,0.297-0.004,0.445-0.006c6.677-0.113,12.993-2.816,17.784-7.609c0.004-0.003,0.006-0.008,0.009-0.011L88.3,39.646C89.604,38.344,89.604,36.229,88.3,34.924z'/%3E%3C/svg%3E") no-repeat center / contain;
		}

		/* í–‰ ì»¨í…Œì´ë„ˆëŠ” ê¸°ì¤€ì´ ë˜ì–´ì•¼ í•¨ */
		.row-b {
			position: relative;
			--deco-gap: 56px;
		}

		/* ë‘ ì•„ì´ì½˜ ì‚¬ì´ ê°„ê²© ì¡°ì ˆ */

		.row-b::before,
		.row-b::after {
			content: "";
			position: absolute;
			top: -30px;
			width: calc(var(--deco-size) * 1.15);
			height: calc(var(--deco-size) * 1.15);
			color: var(--deco-color);
			background-color: #F3DF85;
			filter: drop-shadow(0 1px 3px rgba(0, 0, 0, .25));
			pointer-events: none;
			z-index: 10;
			mask-mode: alpha;
			/* íŒŒì´ì–´í­ìŠ¤ ì¼ê´€ì„± */
		}

		/* ì™¼ìª½(ì„¼í„°ì—ì„œ -gap) : ê¸°ì¡´ 24x24 ê¸°ì–´ ì•„ì´ì½˜ */
		.row-b::before {
			top:-30px;
			left: 50%;
			transform: translateX(-50%) rotate(-6deg);
			-webkit-mask: url("data:image/svg+xml;utf8,%3Csvg width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M20 9c1.66 0 3 1.34 3 3s-1.34 3-3 3h-.76l.54.54a3 3 0 0 1 0 4.24 3 3 0 0 1-4.24 0l-.54-.54V20c0 1.66-1.34 3-3 3s-3-1.34-3-3v-.76l-.54.54a3 3 0 0 1-4.24 0 3 3 0 0 1 0-4.24l.54-.54H4c-1.66 0-3-1.34-3-3s1.34-3 3-3h.76l-.54-.54a3 3 0 0 1 0-4.24 3 3 0 0 1 4.24 0l.54.54V4c0-1.66 1.34-3 3-3s3 1.34 3 3v.76l.54-.54a3 3 0 0 1 4.24 0 3 3 0 0 1 0 4.24l-.54.54H20Zm-4 3a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z'/%3E%3C/svg%3E") no-repeat center / contain;
			mask: url("data:image/svg+xml;utf8,%3Csvg width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M20 9c1.66 0 3 1.34 3 3s-1.34 3-3 3h-.76l.54.54a3 3 0 0 1 0 4.24 3 3 0 0 1-4.24 0l-.54-.54V20c0 1.66-1.34 3-3 3s-3-1.34-3-3v-.76l-.54.54a3 3 0 0 1-4.24 0 3 3 0 0 1 0-4.24l.54-.54H4c-1.66 0-3-1.34-3-3s1.34-3 3-3h.76l-.54-.54a3 3 0 0 1 0-4.24 3 3 0 0 1 4.24 0l.54.54V4c0-1.66 1.34-3 3-3s3 1.34 3 3v.76l.54-.54a3 3 0 0 1 4.24 0 3 3 0 0 1 0 4.24l-.54.54H20Zm-4 3a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z'/%3E%3C/svg%3E") no-repeat center / contain;
		}

		/* ì˜¤ë¥¸ìª½(ì„¼í„°ì—ì„œ +gap) : ìƒˆ 18x18 í•€ ì•„ì´ì½˜ */
		.row-b::after {
			background-color: #DBE09A;
			top: -50px;
			left: 960px;
			transform: translateX(-50%) rotate(6deg);
			-webkit-mask: url("data:image/svg+xml;utf8,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2018%2018'%20fill='%23000'%3E%3Cpath%20d='M14%2010a1%201%200%200%201-1%201h-3v4l-1%203-1-3v-4H5a1%201%200%200%201-1-1c0-1.1.9-3%202-3V2a1%201%200%200%201%200-2h6a1%201%200%200%201%200%202v5c1.1%200%202%201.9%202%203z'/%3E%3C/svg%3E") no-repeat center / contain;
			mask: url("data:image/svg+xml;utf8,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2018%2018'%20fill='%23000'%3E%3Cpath%20d='M14%2010a1%201%200%200%201-1%201h-3v4l-1%203-1-3v-4H5a1%201%200%200%201-1-1c0-1.1.9-3%202-3V2a1%201%200%200%201%200-2h6a1%201%200%200%201%200%202v5c1.1%200%202%201.9%202%203z'/%3E%3C/svg%3E") no-repeat center / contain;
		}


		/* ë°˜ì‘í˜• ë³´ì •(ì„ íƒ): ëª¨ë°”ì¼ì—ì„œ ì¥ì‹ í¬ê¸° ì¤„ì´ê¸° */
		@media (max-width:640px) {
			.gallery-board {
				--deco-size: 22px;
			}
		}
	</style>

</head>

<body class="bg-gradient-to-b from-[#e4f0b9] to-[#fcdca9] h-screen min-h-dvh min-w-[1400px]">

	<div class="flex h-screen w-full">

		<div th:replace="common :: siteHeader"></div>

		<!-- Main content -->
		<main class="main_page h-full overflow-y-auto min-h-dvh flex-1">

			<div class="sticky top-0 z-20 bg-white/80 backdrop-blur-sm pb-3">
				<div class="h-4"></div>
				<h2>ğŸ¾ ê°ì • ê²°ê³¼ ê°¤ëŸ¬ë¦¬</h2>

				<div class="tabs sticy">
					<button class="emotion-btn active" onclick="showGallery('happy')">ğŸ˜Š Happy</button>
					<button class="emotion-btn" onclick="showGallery('relaxed')">ğŸ˜Œ Relaxed</button>
					<button class="emotion-btn" onclick="showGallery('sad')">ğŸ¥² Sad</button>
					<button class="emotion-btn" onclick="showGallery('scared')">ğŸ˜¨ Scared</button>
				</div>
			</div>



			<div class="max-w-[1100px] mx-auto md:px-10">
				<div th:each="emotion : ${emotionList}"
					th:class="'gallery-section ' + (emotion == 'happy' ? 'active' : '')"
					th:id="'section-' + ${emotion}">
					<div th:id="'track-' + ${emotion}" class="gallery-track">
						<div th:each="item : ${analysisList}" th:if="${item.emotionResult == emotion}" class="relative gallery-item group bg-white rounded-[22px] p-2 shadow-[0_12px_30px_rgba(0,0,0,0.12)]
							ring-1 ring-black/5 transition-transform hover:-translate-y-0.5">
							<img th:src="${item.imagePath}" alt="Pet Image" loading="lazy"
								class="w-full h-full object-cover">
							<div class="px-3 pb-3 pt-2 text-center">
								<div th:text="${item.emotionResult}" class="text-xl font-extrabold tracking-tight">
								</div>
								<div class="text-xs text-neutral-500 mt-0.5"
									th:text="'ì‹ ë¢°ë„: ' + ${item.confidence} + '%'">
								</div>
								<div class="text-xs text-neutral-400" th:text="'ë‚ ì§œ: ' + ${item.analyzedAt}"></div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</main>
	</div>


	<script>
		document.addEventListener('DOMContentLoaded', () => {
			buildRowsForAllSections(4);     // 4ì¥ì”© í•œ í–‰
			showGallery('happy');           // ì´ˆê¸° íƒ­
		});

		let currentEmotion = 'happy';

		function showGallery(emotion) {
			document.querySelectorAll('.emotion-btn').forEach(btn => {
				btn.classList.toggle('active', btn.textContent.toLowerCase().includes(emotion));
			});
			document.querySelectorAll('.gallery-section').forEach(sec => sec.classList.remove('active'));
			document.getElementById('section-' + emotion).classList.add('active');
			currentEmotion = emotion;
		}

		/** ê° ì„¹ì…˜ì˜ .gallery-itemì„ rowSizeì”© ì˜ë¼ row-a/row-bë¡œ ê°ì‹¸ê³ ,
		 *  ì»¨í…Œì´ë„ˆ .gallery-track -> .gallery-boardë¡œ ë³€ê²½
		 */
		function buildRowsForAllSections(rowSize = 4) {
			document.querySelectorAll('.gallery-section').forEach(section => {
				const track = section.querySelector('.gallery-track');
				if (!track) return;

				// ì»¨í…Œì´ë„ˆ í´ë˜ìŠ¤ ì „í™˜
				track.classList.remove('gallery-track');
				track.classList.add('gallery-board');

				// ì•„ì´í…œ ìˆ˜ì§‘
				const items = Array.from(track.querySelectorAll('.gallery-item'));
				// ê¸°ì¡´ ë…¸ë“œ ì œê±°
				track.innerHTML = '';

				// í–‰ ë§Œë“¤ê¸° (A/B ë²ˆê°ˆì•„)
				let rowIndex = 0;
				for (let i = 0; i < items.length; i += rowSize) {
					const slice = items.slice(i, i + rowSize);
					const row = document.createElement('div');
					row.className = 'row ' + (rowIndex % 2 === 0 ? 'row-a' : 'row-b');
					rowIndex++;

					slice.forEach(item => {
						item.classList.remove('gallery-item');
						item.classList.add('card');
						// lazy ë³´ì¥ + ëŒ€ì²´ í…ìŠ¤íŠ¸
						const img = item.querySelector('img');
						if (img) {
							img.loading = img.loading || 'lazy';
							if (!img.alt || img.alt === 'Pet Image') {
								const title = item.querySelector('strong')?.textContent?.trim() || 'photo';
								img.alt = title;
							}
						}
						row.appendChild(item);
					});
					track.appendChild(row);
				}
			});
		}
	</script>


</body>

</html>