<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Login</title>
	<link rel="stylesheet" th:href="@{/resource/css/login_join.css}">
	<script src="https://cdn.tailwindcss.com"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<style>
		.form-panel-slide {
			display: flex;
			transition: transform 0.3s ease;
		}
		.form-step {
			width: 100%;
			padding: 1rem;
		}
	</style>
</head>
<body class="bg-white">

<div class="form-wrapper flex-row overflow-hidden relative" id="form-wrapper">
	<div class="form-slider w-[200%] flex transition-transform duration-300">
		<!-- ë¡œê·¸ì¸ í™”ë©´ -->
		<div class="sign-in flex w-full relative">
			<!-- ë¡œê·¸ì¸ í¼ -->
			<form class="left-panel h-full w-3/5 p-6" th:action="@{/usr/member/doLogin}" method="post">
				<h1>LOGIN</h1>
				<input type="text" name="loginId" placeholder="ID" required th:value="${param.loginId}" />
				<input type="password" name="loginPw" placeholder="PW" required />
				<button class="sign-in-button" type="submit">sign in</button>
				<img class="logo-img mt-4" th:src="@{/img/logo.png}" alt="Aniwell Logo">
			</form>

			<!-- íšŒì›ê°€ì… ë²„íŠ¼ -->
			<div class="right-panel h-full w-2/5 flex items-center justify-center bg-yellow-100">
				<span class="sign-up-button cursor-pointer text-lg font-semibold text-gray-700" id="show-sign-up">íšŒì›ê°€ì…</span>
			</div>
		</div>

		<!-- íšŒì›ê°€ì… í™”ë©´ -->
		<div class="sign-up flex w-full relative">
			<!-- ì™¼ìª½ ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸° -->
			<div class="left-panel w-2/5 flex items-center justify-center bg-yellow-100">
				<span class="sign-in-button cursor-pointer text-lg font-semibold text-gray-700" id="show-sign-in">ë¡œê·¸ì¸</span>
			</div>

			<!-- ì˜¤ë¥¸ìª½ íšŒì›ê°€ì… -->
			<form class="form-panel w-3/5 relative overflow-hidden"
				  th:action="@{/usr/member/doJoin}" method="post"
				  onsubmit="return validateForm()">

				<div class="form-panel-slide h-full flex relative" id="slide-panel">
					<!-- STEP 1 -->
					<div class="form-step flex flex-col justify-around" id="step1">
						<h2>Create Account</h2>
						<input type="text" name="loginId" placeholder="ID" required th:value="${param.loginId}" />
						<input type="password" name="loginPw" placeholder="PW" required />
						<input type="text" name="name" placeholder="NAME" required th:value="${param.name}" />
						<input type="text" name="nickname" placeholder="NICKNAME" required th:value="${param.nickname}" />
						<button type="button" class="next-button bg-yellow-400 p-2 rounded" onclick="goToStep(2)">ë‹¤ìŒ</button>
					</div>

					<!-- STEP 2 -->
					<div class="form-step flex flex-col justify-around" id="step2">
						<h2>Contact Info</h2>
						<input type="text" name="cellphone" placeholder="PHONE NUMBER" required th:value="${param.cellphone}">
						<input type="email" name="email" placeholder="EMAIL" required th:value="${param.email}" />
						<input type="text" name="address" placeholder="ADDRESS" required th:value="${param.address}" />

						<select name="authName" onchange="updateAuthLevel()" required>
							<option value="ì¼ë°˜" th:selected="${param.authName == 'ì¼ë°˜'}">ì¼ë°˜</option>
							<option value="ìˆ˜ì˜ì‚¬" th:selected="${param.authName == 'ìˆ˜ì˜ì‚¬'}">ìˆ˜ì˜ì‚¬</option>
						</select>

						<input type="hidden" id="authLevel" name="authLevel" th:value="${param.authLevel ?: 1}" />
						<button type="button" class="prev-button" onclick="goToStep(1)">ë’¤ë¡œê°€ê¸°</button>
						<button type="submit" class="submit-button bg-green-400 p-2 rounded text-white">sign up</button>
					</div>
				</div>

				<!-- ğŸ¾ ë°œë°”ë‹¥ íƒ€ì„ë¼ì¸ -->
				<div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-4 z-10">
					<img id="paw1" src="/img/paw_active.png" class="w-10 h-10 transition-transform duration-300" />
					<img id="paw2" src="/img/paw_inactive.png" class="w-10 h-10 transition-transform duration-300" />
				</div>
			</form>
		</div>
	</div>
</div>

<script>
	// ë¡œê·¸ì¸ â†” íšŒì›ê°€ì… ì „í™˜
	$(document).ready(function () {
		$('#show-sign-up').on('click', function () {
			$('.form-slider').css('transform', 'translateX(-50%)');
		});
		$('#show-sign-in').on('click', function () {
			$('.form-slider').css('transform', 'translateX(0)');
		});
	});

	let currentStep = 1;

	function goToStep(step) {
		currentStep = step;
		const slide = document.querySelector('.form-panel-slide');
		slide.style.transform = `translateX(${step === 1 ? '0' : '-100%'})`;

		// ë°œë°”ë‹¥ ì´ë¯¸ì§€ ë³€ê²½
		document.getElementById('paw1').src = step === 1 ? '/img/paw_active.png' : '/img/paw_inactive.png';
		document.getElementById('paw2').src = step === 2 ? '/img/paw_active.png' : '/img/paw_inactive.png';
	}

	// ë“œë˜ê·¸ ì´ë²¤íŠ¸
	const panel = document.getElementById('slide-panel');
	let startX = 0, isDragging = false;

	panel.addEventListener('mousedown', (e) => {
		startX = e.clientX;
		isDragging = true;
	});

	panel.addEventListener('mouseup', (e) => {
		if (!isDragging) return;
		const deltaX = e.clientX - startX;
		if (deltaX < -50 && currentStep === 1) goToStep(2);
		else if (deltaX > 50 && currentStep === 2) goToStep(1);
		isDragging = false;
	});

	// ëª¨ë°”ì¼ í„°ì¹˜
	panel.addEventListener('touchstart', (e) => {
		startX = e.touches[0].clientX;
		isDragging = true;
	});

	panel.addEventListener('touchend', (e) => {
		if (!isDragging) return;
		const endX = e.changedTouches[0].clientX;
		const deltaX = endX - startX;
		if (deltaX < -50 && currentStep === 1) goToStep(2);
		else if (deltaX > 50 && currentStep === 2) goToStep(1);
		isDragging = false;
	});

	function updateAuthLevel() {
		const auth = document.querySelector('[name="authName"]').value;
		document.getElementById('authLevel').value = auth === 'ìˆ˜ì˜ì‚¬' ? 9 : 1;
	}

	function validateForm() {
		const phone = document.querySelector('[name="cellphone"]');
		const phonePattern = /^\d{3}-\d{3,4}-\d{4}$/;
		if (!phonePattern.test(phone.value)) {
			alert("ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜ˆ: 000-0000-0000");
			return false;
		}

		const addressInput = document.getElementById("address");
		console.log("ğŸš¨ address.value:", addressInput?.value);

		if (!addressInput || addressInput.value.trim() === "") {
			alert("ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. ìš°í¸ë²ˆí˜¸ ì°¾ê¸°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.");
			return false;
		}
		return true;
	}

	// step1ì—ì„œ Enter í‚¤ë¡œ ë‹¤ìŒ ë‹¨ê³„ ì´ë™
	document.addEventListener('DOMContentLoaded', function () {
		document.querySelectorAll('#step1 input').forEach(input => {
			input.addEventListener('keydown', function (e) {
				if (e.key === 'Enter') {
					e.preventDefault();
					goToStep(2);
				}
			});
		});

		const phoneInput = document.querySelector('[name="cellphone"]');
		phoneInput.addEventListener('input', function (e) {
			let value = e.target.value.replace(/\D/g, '');
			let result = '';
			if (value.length < 4) {
				result = value;
			} else if (value.length < 7) {
				result = value.slice(0, 3) + '-' + value.slice(3);
			} else if (value.length < 11) {
				result = value.slice(0, 3) + '-' + value.slice(3, 6) + '-' + value.slice(6);
			} else {
				result = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
			}
			e.target.value = result;
		});
	});
</script>

</body>
</html>
