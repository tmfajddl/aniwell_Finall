<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.RSW.repository.VisitRepository">

	<resultMap id="VisitMap" type="com.example.RSW.vo.Visit">
		<id column="id" property="id" />
		<result column="pet_id" property="petId" />
		<result column="visit_date" property="visitDate" />  <!-- ★ -->
		<result column="hospital" property="hospital" />
		<result column="doctor" property="doctor" />
		<result column="diagnosis" property="diagnosis" />
		<result column="notes" property="notes" />
		<result column="total_cost" property="totalCost" />
		<result column="created_at" property="createdAt" />
		<result column="updated_at" property="updatedAt" />
	</resultMap>


	<!-- INSERT -->
	<!-- [수정] VO 패키지 경로: com.example.domain → com.example.RSW.vo -->
	<insert id="insertVisit"
		parameterType="com.example.RSW.vo.Visit" useGeneratedKeys="true"
		keyProperty="id" keyColumn="id">
		INSERT INTO visit
		(pet_id, visit_date,
		hospital, doctor, diagnosis, notes, total_cost)
		VALUES
		(#{petId},
		#{visitDate}, #{hospital}, #{doctor}, #{diagnosis}, #{notes},
		#{totalCost})
	</insert>

	<!-- UPDATE -->
	<!-- [수정] VO 패키지 경로 교정 -->
	<update id="updateVisit"
		parameterType="com.example.RSW.vo.Visit">
		UPDATE visit
		SET
		visit_date = #{visitDate},
		hospital =
		#{hospital},
		doctor = #{doctor},
		diagnosis = #{diagnosis},
		notes =
		#{notes},
		total_cost = #{totalCost}
		WHERE id = #{id}
	</update>


	<!-- DELETE -->
	<delete id="deleteVisit" parameterType="int">
		DELETE FROM visit
		WHERE id
		= #{id}
	</delete>


	<!-- SELECT: petId로 조회 -->
	<!-- [수정] resultType 패키지 경로 교정 -->
	<select id="selectVisitsByPetId" parameterType="int"
		resultMap="VisitMap">
		SELECT id, pet_id, visit_date, hospital, doctor, diagnosis,
		notes,
		total_cost, created_at, updated_at
		FROM visit
		WHERE pet_id = #{petId}
		ORDER BY
		visit_date DESC, id DESC
	</select>



	<select id="selectVisitById" parameterType="int" resultMap="VisitMap">
		SELECT id, pet_id, visit_date, hospital, doctor, diagnosis, notes,
			   total_cost, created_at, updated_at
		FROM visit
		WHERE id = #{id}
		ORDER BY visit_date DESC, id DESC
	</select>

	<update id="updateHospital">
		UPDATE visit
		SET hospital = #{hospital}
		WHERE id = #{visitId}
	</update>

</mapper>

